--------------------------------
2019/12/2:
Kevin:
上线无问题
沟通与学习能力加强
沟通态度需要改进
2020年:
k8s/python

学习能力强，做事踏实
重要问题考虑不全，思维不够全


Jerry:
注重细节
对事不对人
包容心

James:
考虑事件比较细
学习比较快
拖延
做事比较急，性格暴躁
学习比较被动
做事有头没尾


----------------------------------------------


改善地方：
目前各个系统是在虚拟机上安装的docker，资源得不到利用
运维脚本升级python？
web化运维工具研究
将所有机器去掉虚拟机并docker化(除报表windows系统外)
推进k8s, 使服务器资源最优化
所有业务系统有主备
skywalking推广

升级docker为1.17版本（香港现金货还没有升级）
sso香港国内各部署一台
备份外网vpn方案
权限系统共同：数据权限
阿里云vpn专线
SSO集群部署
通过jenkins自动推送gitlab中的脚本到服务端
（不允许直接修改服务器上的脚本） --- 对现在有的脚本有较大的影响，暂停此工作
zerofinance.cn的域名ssl，银联

今年学习计划：
1. 领域驱动设计
2. 微服务设计模式
3. Kubernetes
4. spring alibaba cloud
5. spring cloud kubernetes
6. istio
7. serverless
8. hadoop flink spark hive
9. kylin
-------------------------------------------------


James:
如何监控并杜绝类似的问题发生：点检表

未来工作：
南山办公室以新的vpn方案实施:深圳idc搬回后，将idc防火墙搬回后放到南山办公室
国内阿里云外网vpn拨号后不能访问
员工管理系统改为集群
阿里云云企业网费用，打通所有阿里云内部网络
阿里云VPN网关
外网供应商服务如何隔离
南山办公室所有的监控：包括系统/网络/访问外网等
kingsoft备份
jumpserver资产
生产环境jenkins机器的权限：运维才能访问
视频会议文件永久存储


测试的生产数据保留一段时间后再删除（何雨）
react 的hooks技术，在16版本后推出的，已经完全替代了class的写法，并且抽象性更好

http://192.168.80.196:7070/kylin
http://192.168.80.196:50070/dfshealth.html#tab-overview
http://192.168.80.196:8088/cluster
http://192.168.80.196:16010/master-status

默认的系统管理员 ADMIN 的密码为 KYLIN

http://kylin.apache.org/cn/docs/tutorial/create_cube.html
https://juejin.im/post/5bd81eafe51d457b26679917
https://juejin.im/post/5bc34a246fb9a05cfd27fe54
https://www.jianshu.com/p/4f4417ef790a
https://blog.csdn.net/qq_43147136/article/details/89189759

MySQL: 
mysql -uroot -h192.168.80.196 -pGk97TU6coSsvtipC9SB2

/home/admin/sqoop-1.4.7/bin/sqoop list-databases --connect jdbc:mysql://192.168.80.196:3306 --username root --password Gk97TU6coSsvtipC9SB2

https://www.cnblogs.com/chushiyaoyue/p/5707683.html


https://blog.csdn.net/qq_31598113/article/details/82387952
https://www.cnblogs.com/chwilliam85/p/9693276.html
#https://www.cnblogs.com/scw2901/p/4331682.html
https://blog.csdn.net/dai451954706/article/details/50464036/
https://blog.csdn.net/zhouyan8603/article/details/47398245
docker run -d \
-m 50G --name kylin \
-p 7070:7070 \
-p 8088:8088 \
-p 50070:50070 \
-p 8032:8032 \
-p 8042:8042 \
-p 16010:16010 \
apachekylin/apache-kylin-standalone:3.0.1
docker cp /etc/localtime kylin:/etc/localtime
docker restart kylin
docker exec -it kylin /bin/bash

https://www.cnblogs.com/tianphone/p/10763385.html
yum install epel-release vim openssh-server -y
yum -y install htop
/etc/init.d/sshd start
chkconfig sshd on

https://www.jianshu.com/p/20935b0d1940
ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
chmod 0600 ~/.ssh/authorized_keys

scp -r dave@192.168.102.136:/Developer/Kylin/Drivers .
tar zxvf Drivers/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz -C /home/admin/
mv sqoop-1.4.7.bin__hadoop-2.6.0 sqoop-1.4.7

vim /etc/profile
export SQOOP_HOME=/home/admin/sqoop-1.4.7
export PATH=$SQOOP_HOME/bin:$PATH
. /etc/profile

vim ./hadoop-2.7.0/etc/hadoop/hadoop-env.sh
export JAVA_HOME=/home/admin/jdk1.8.0_141

cp -a Drivers/mysql-connector-java-5.1.48-bin.jar $KYLIN_HOME/ext
cp -a Drivers/mysql-connector-java-5.1.48-bin.jar $SQOOP_HOME/lib



vim $KYLIN_HOME/conf/kylin.properties:
kylin.source.default=8
kylin.source.jdbc.connection-url=jdbc:mysql://192.168.80.196:3306/dwh?dontTrackOpenResources=true&defaultFetchSize=1000&useCursorFetch=true
kylin.source.jdbc.driver=com.mysql.jdbc.Driver
kylin.source.jdbc.dialect=mysql
kylin.source.jdbc.user=root
kylin.source.jdbc.pass=Gk97TU6coSsvtipC9SB2
kylin.source.jdbc.sqoop-home=/home/admin/sqoop-1.4.7
kylin.source.jdbc.filed-delimiter=|
注意：修改以上jdbc配置，job需要删除并重新创建才能生效

vim ./hadoop-2.7.0/etc/hadoop/mapred-site.xml
    <property>
        <name>mapreduce.jobhistory.address</name>
        <value>0.0.0.0:10020</value>
    <description>MapReduce JobHistory Server IPC host:port</description>
    </property>

    <property>
        <name>mapreduce.jobhistory.webapp.address</name>
        <value>0.0.0.0:19888</value>
    <description>MapReduce JobHistory Server Web UI host:port</description>
    </property>

     <!--每个Map Task需要的物理内存量-->
    <property>
        <name>mapreduce.map.memory.mb</name>
        <!--修改前<value>2048</value>-->
        <value>3072</value>
    </property>
    <!--每个Reduce Task需要的物理内存量-->
    <property>
        <name>mapreduce.reduce.memory.mb</name>
        <!--修改前<value>3072</value>-->
    <value>5120</value>
    </property>
    <property>
        <name>mapreduce.map.java.opts</name>
        <!--须小于mapreduce.map.memory.mb的值-->
        <value>-Xmx2560m</value>
    </property>
    <property>
        <name>mapreduce.reduce.java.opts</name>
        <!--须小于mapreduce.reduce.memory.mb的值-->
        <value>-Xmx4608m</value>
    </property>

https://stackoverflow.com/questions/50129537/why-does-hadoop-on-windows-trying-to-connect-0-0-0-010020-unsuccessfully
mapred historyserver
lsof -i:10020
#./hadoop-2.7.0/sbin/stop-all.sh
#./hadoop-2.7.0/sbin/start-all.sh
tail -n100 -f /home/admin/apache-kylin-3.0.1-bin-hbase1x/logs/kylin.log

解决Extract Fact Table Distinct Columns卡死的问题：
vim ./hadoop-2.7.0/etc/hadoop/yarn-site.xml
    <!--<property>
        <name>yarn.nodemanager.resource.memory-mb</name>
        <value>6144</value>
    </property>-->
    <!-- 设置每个节点的可用内存，单位MB。合理设置该参数，将影响到DataNode的运行情况 -->
    <property>
       <name>yarn.nodemanager.resource.memory-mb</name>
       <value>40960</value>
    </property>
    <!-- 单个任务可申请的最小内存，默认1024MB -->
    <property>
       <name>yarn.scheduler.minimum-allocation-mb</name>
       <value>2048</value>
    </property>
    <!-- 单个任务可申请的最大内存，默认8192MB
    <property>
       <name>yarn.scheduler.maximum-allocation-mb</name>
       <value>8192</value>
    </property> -->
    <property>
        <name>yarn.nodemanager.vmem-pmem-ratio</name>
        <value>2.1</value>
    </property>
    <!-- 设置每个节点虚拟cpu内核数 -->
     <property>
        <name>yarn.nodemanager.resource.cpu-vcores</name>
        <value>62</value>
    </property>

docker restart kylin


dwh.dws_fin_loan_account_d,dwh.dim_account_age,dwh.dim_client,dwh.dim_collection_status,dwh.dim_contract,dwh.dim_date,dwh.dim_loan_account,dwh.dim_loan_account_process_status,dwh.dim_loan_account_status,dwh.dim_loan_account_type,dwh.dim_loan_bill,dwh.dim_loan_product,dwh.dim_loan_type,dwh.dim_repay_amount_type,dwh.dim_source_system,dwh.dim_trading_summary,dwh.dim_virtual_center,dwh.dws_fin_exempt

performance:
4-5 core less than 30G RAM
21,475,144: 4.6h
2,145,539: 48min

https://www.jianshu.com/p/57178dce12de

SELECT dws_fin_loan_account_d.fin_loan_account_d_id as DWS_FIN_LOAN_ACCOUNT_D_FIN_LOAN_ACCOUNT_D_ID ,dws_fin_loan_account_d.snap_date_key ,dws_fin_loan_account_d.loan_bill_id as DWS_FIN_LOAN_ACCOUNT_D_LOAN_BILL_ID ,dws_fin_loan_account_d.loan_client_id as DWS_FIN_LOAN_ACCOUNT_D_LOAN_CLIENT_ID ,dws_fin_loan_account_d.loan_account_id as DWS_FIN_LOAN_ACCOUNT_D_LOAN_ACCOUNT_ID ,dim_date.date_key as DIM_DATE_DATE_KEY ,dws_fin_loan_account_d.principal_balance_repay_amount as DWS_FIN_LOAN_ACCOUNT_D_PRINCIPAL_BALANCE_REPAY_AMOUNT ,dws_fin_loan_account_d.principal_balance_repay_irr_amount as DWS_FIN_LOAN_ACCOUNT_D_PRINCIPAL_BALANCE_REPAY_IRR_AMOUNT ,dws_fin_loan_account_d.principal_balance_process_amount as DWS_FIN_LOAN_ACCOUNT_D_PRINCIPAL_BALANCE_PROCESS_AMOUNT ,dws_fin_loan_account_d.principal_balance_process_irr_amount as DWS_FIN_LOAN_ACCOUNT_D_PRINCIPAL_BALANCE_PROCESS_IRR_AMOUNT  FROM dwh.dws_fin_loan_account_d dws_fin_loan_account_d INNER JOIN dwh.dim_date dim_date ON dws_fin_loan_account_d.snap_date_key = dim_date.date_key WHERE 1=1 AND (dws_fin_loan_account_d.snap_date_key >= '2020-01-01' AND dws_fin_loan_account_d.snap_date_key < '2020-04-30')


SELECT min(snap_date_key), max(snap_date_key) FROM dwh.dws_fin_loan_account_d  WHERE dws_fin_loan_account_d.snap_date_key >= '2020-01-01' AND dws_fin_loan_account_d.snap_date_key < '2020-04-30'

SELECT dws_fin_loan_account_d.snap_date_key as SNAP_DATE_KEY, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_REPAY_AMOUNT) as PRINCIPAL_BALANCE_REPAY_AMOUNT, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_REPAY_IRR_AMOUNT) as PRINCIPAL_BALANCE_REPAY_IRR_AMOUNT, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_PROCESS_AMOUNT) as PRINCIPAL_BALANCE_PROCESS_AMOUNT,
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_PROCESS_IRR_AMOUNT) as PRINCIPAL_BALANCE_PROCESS_IRR_AMOUNT
FROM dwh.dws_fin_loan_account_d  
WHERE dws_fin_loan_account_d.snap_date_key >= '2020-01-01' 
AND dws_fin_loan_account_d.snap_date_key < '2020-04-30' 
GROUP BY dws_fin_loan_account_d.snap_date_key

SELECT dws_fin_loan_account_d.snap_date_key as SNAP_DATE_KEY, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_REPAY_AMOUNT) as PRINCIPAL_BALANCE_REPAY_AMOUNT, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_REPAY_IRR_AMOUNT) as PRINCIPAL_BALANCE_REPAY_IRR_AMOUNT, 
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_PROCESS_AMOUNT) as PRINCIPAL_BALANCE_PROCESS_AMOUNT,
sum(DWS_FIN_LOAN_ACCOUNT_D.PRINCIPAL_BALANCE_PROCESS_IRR_AMOUNT) as PRINCIPAL_BALANCE_PROCESS_IRR_AMOUNT
FROM dwh.dws_fin_loan_account_d dws_fin_loan_account_d 
INNER JOIN dwh.dim_date dim_date ON dws_fin_loan_account_d.snap_date_key = dim_date.date_key 
WHERE 1=1 
AND (dws_fin_loan_account_d.snap_date_key >= '2013-01-01' 
AND dws_fin_loan_account_d.snap_date_key < '2020-04-30')
GROUP BY dws_fin_loan_account_d.snap_date_key

